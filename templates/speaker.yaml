# DO NOT EDIT - For maintainability, we should keep this as close to the
# upstream manifest as possible.
#
# https://raw.githubusercontent.com/kubeovn/kube-ovn/v1.10.4/yamls/speaker.yaml
# N.B. The 1.10.4 speaker.yaml above lists kube-ovn:v1.10.0" as its image. This has been changed to 1.10.4

kind: DaemonSet
apiVersion: apps/v1
metadata:
  name: kube-ovn-speaker
  namespace: kube-system
spec:
  selector:
    matchLabels:
      app: kube-ovn-speaker
  template:
    metadata:
      labels:
        app: kube-ovn-speaker
        component: network
        type: infra
    spec:
      tolerations:
        - operator: Exists
          effect: NoSchedule
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchLabels:
                  app: kube-ovn-speaker
              topologyKey: kubernetes.io/hostname
      priorityClassName: system-node-critical
      serviceAccountName: ovn
      hostNetwork: true
      containers:
        - name: kube-ovn-speaker
          image: "kubeovn/kube-ovn:v1.10.4"
          imagePullPolicy: IfNotPresent
          command:
            - /kube-ovn/kube-ovn-speaker
          args:
            - --neighbor-address=10.32.32.1
            - --neighbor-as=65030
            - --cluster-as=65000
          env:
            - name: POD_IP
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP
          resources:
            requests:
              cpu: 500m
              memory: 300Mi
      nodeSelector:
        kubernetes.io/os: "linux"
        ovn.kubernetes.io/bgp: "true"